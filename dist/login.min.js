Wu={},Wu.Class=function(){},Wu.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks.length&&this.callInitHooks()},c=b.__super__=this.prototype,d=Wu.Util.create(c);d.constructor=b,b.prototype=d;for(var e in this)this.hasOwnProperty(e)&&"prototype"!==e&&(b[e]=this[e]);return a.statics&&(Wu.extend(b,a.statics),delete a.statics),a.includes&&(Wu.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),d.options&&(a.options=Wu.Util.extend(Wu.Util.create(d.options),a.options)),Wu.extend(d,a),d._initHooks=[],d.callInitHooks=function(){if(!this._initHooksCalled){c.callInitHooks&&c.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,b=d._initHooks.length;b>a;a++)d._initHooks[a].call(this)}},b},Wu.Class.include=function(a){Wu.extend(this.prototype,a)},Wu.Class.mergeOptions=function(a){Wu.extend(this.prototype.options,a)},Wu.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1),c="function"==typeof a?a:function(){this[a].apply(this,b)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c)},Wu.Util={extend:function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(c=0,d=f.length;d>c;c++){e=f[c];for(b in e)a[b]=e[b]}return a},create:Object.create||function(){function a(){}return function(b){return a.prototype=b,new a}}(),bind:function(a,b){var c=Array.prototype.slice;if(a.bind)return a.bind.apply(a,c.call(arguments,1));var d=c.call(arguments,2);return function(){return a.apply(b,d.length?d.concat(c.call(arguments)):arguments)}},stamp:function(a){return a._leaflet_id=a._leaflet_id||++Wu.Util.lastId,a._leaflet_id},lastId:0,throttle:function(a,b,c){var d,e,f,g;return g=function(){d=!1,e&&(f.apply(c,e),e=!1)},f=function(){d?e=arguments:(a.apply(c,arguments),setTimeout(g,b),d=!0)}},wrapNum:function(a,b,c){var d=b[1],e=b[0],f=d-e;return a===d&&c?a:((a-e)%f+f)%f+e},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},trimAll:function(a){return a.replace(/\s+/g,"")},splitWords:function(a){return Wu.Util.trim(a).split(/\s+/)},setOptions:function(a,b){a.hasOwnProperty("options")||(a.options=a.options?Wu.Util.create(a.options):{});for(var c in b)a.options[c]=b[c];return a.options},getParamString:function(a,b,c){var d=[];for(var e in a)d.push(encodeURIComponent(c?e.toUpperCase():e)+"="+encodeURIComponent(a[e]));return(b&&-1!==b.indexOf("?")?"&":"?")+d.join("&")},template:function(a,b){return a.replace(Wu.Util.templateRe,function(a,c){var d=b[c];if(void 0===d)throw new Error("No value provided for variable "+a);return"function"==typeof d&&(d=d(b)),d})},templateRe:/\{ *([\w_]+) *\}/g,emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},setAddressBar:function(a){window.history.pushState({},"",a)},checkDisconnect:function(a){var b=a.substring(0,15);return"<!doctype html>"==b?(app.feedback.setError({title:"You have been logged out.",description:"Please reload the page to log back in.",clearTimer:!1}),!1):!0},debugXML:function(a){Wu.parse(a)},verifyResponse:function(a){return app.debug&&Wu.Util.debugXML(a),Wu.Util.checkDisconnect(a)},post:function(a,b){var c=new XMLHttpRequest,d=Wu.Util._getServerUrl();d+=a,c.open("POST",d,!0),c.setRequestHeader("Content-type","application/json"),c.setRequestHeader("Authorization","Bearer "+app.tokens.access_token),c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){Wu.verify(c.responseText)}},c.send(b)},postcb:function(a,b,c,d,e){var f=new XMLHttpRequest,g=e||Wu.Util._getServerUrl();g+=a,f.open("POST",g,!0),f.setRequestHeader("Content-type","application/json"),f.setRequestHeader("Authorization","Bearer "+app.tokens.access_token),f.onreadystatechange=function(){if(4==f.readyState&&200==f.status){var a=Wu.verify(f.responseText);c&&a&&c(d,f.responseText)}},Wu.Util.isObject(b)&&(b=JSON.stringify(b)),f.send(b)},send:function(a,b,c){var d=new XMLHttpRequest,e=Wu.Util._getServerUrl();e+=a,d.open("POST",e,!0),d.setRequestHeader("Content-type","application/json"),d.setRequestHeader("Authorization","Bearer "+app.tokens.access_token),d.onreadystatechange=function(){if(4==d.readyState){var a=Wu.verify(d.responseText);200==d.status&&a?c&&c(null,d.responseText):c&&c(d.status)}},Wu.Util.isObject(b)&&(b=JSON.stringify(b)),d.send(b)},_getServerUrl:function(){return app.options.servers.portal.slice(0,-1)},_getJSON:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var a=Wu.verify(c.responseText);a&&b(c.responseText)}},c.send(null)},_parse:function(a){try{var b=JSON.parse(a);return b}catch(c){return!1}},_stringify:function(a){try{var b=JSON.stringify(a);return b}catch(c){return!1}},_getParentClientID:function(a){var b="";for(c in Wu.app.Clients){var d=Wu.app.Clients[c];d.projects.forEach(function(c,e,f){c==a&&(b=d.uuid)})}return b||(b=Wu.app._activeClient.uuid),b},guid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});return a?a+"-"+b:b},createRandom:function(a){return Math.random().toString(36).slice(-1*a).toUpperCase()},getRandomChars:function(a,b){b=b||"abcdefghijklmnopqrstuvwxyz";for(var c="",d=0;a>d;d++){var e=Math.floor(Math.random()*b.length);c+=b.substring(e,e+1)}return c},deselectText:function(){var a="getSelection"in window?window.getSelection():"selection"in document?document.selection:null;"removeAllRanges"in a?a.removeAllRanges():"empty"in a&&a.empty()},generateZip:function(a){var b=LZString.compress(a);return b},zipSave:function(a,b){var c,c=b,d=new LZMA("//85.10.202.87:8080/js/lib/lzma/lzma_worker.js");d.compress(c,1,function(b){var c=JSON.stringify(b),d=new XMLHttpRequest,e=window.location.origin;e+=a,d.open("POST",e,!0),d.onreadystatechange=function(){4==d.readyState&&200==d.status},d.send(c)},function(a){})},zippedSave:function(){},setColorTheme:function(){injectCSS()},prettyDate:function(a,b){function c(a,b){var c=.1;return a>=b&&b*(1+c)>=a?b:a}if(a){var d,e={ago:"Ago",from:"",now:"Just Now",minute:"Minute",minutes:"Minutes",hour:"Hour",hours:"Hours",day:"Day",days:"Days",week:"Week",weeks:"Weeks",month:"Month",months:"Months",year:"Year",years:"Years"},f=[[60,e.now],[3600,e.minute,e.minutes,60],[86400,e.hour,e.hours,3600],[604800,e.day,e.days,86400],[2628e3,e.week,e.weeks,604800],[31536e3,e.month,e.months,2628e3],[1/0,e.year,e.years,31536e3]],g="string"==typeof a,a=g?new Date((""+a).replace(/-/g,"/").replace(/T|(?:\.\d+)?Z/g," ")):a,b=b||new Date,h=(b-a+6e4*(b.getTimezoneOffset()-(g?0:a.getTimezoneOffset())))/1e3;0>h?(h=Math.abs(h),d=e.from?" "+e.from:""):d=e.ago?" "+e.ago:"";for(var i=0,j=f[0];f[i];j=f[++i])if(h<j[0]){if(0===i)return j[1];var k=Math.ceil(c(h,j[3])/j[3]);return k+" "+(1!=k?j[2]:j[1])+(i>0?d:"")}}},stripAccents:function(a){var b={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","ß":"s","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"l","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ǻ":"A","ǻ":"a","Ǽ":"AE","ǽ":"ae","Ǿ":"O","ǿ":"o"},c=/\W/g,d=function(a){return b[a]||a};return a.replace(c,d)},bytesToSize:function(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Byte";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]},parseUrl:function(){var a=window.location.search.substr(1),b={};return a.split("&").forEach(function(a){var c=a.split("=");""!=c[0]&&(b[c[0]]=decodeURIComponent(c[1]))}),_.size(b)?b:!1},getWindowSize:function(){var a={width:window.innerWidth,height:window.innerHeight};return a},setStyle:function(a,b){jss.set(a,b)},getStyle:function(a){return jss.getAll(a)},confirm:function(a,b){var c=confirm(a);return b&&b(c),c}},function(){function a(a){return window["webkit"+a]||window["moz"+a]||window["ms"+a]}function b(a){var b=+new Date,d=Math.max(0,16-(b-c));return c=b+d,window.setTimeout(a,d)}var c=0,d=window.requestAnimationFrame||a("RequestAnimationFrame")||b,e=window.cancelAnimationFrame||a("CancelAnimationFrame")||a("CancelRequestAnimationFrame")||function(a){window.clearTimeout(a)};Wu.Util.requestAnimFrame=function(a,c,e,f){return e&&d===b?void a.call(c):d.call(window,Wu.bind(a,c),f)},Wu.Util.cancelAnimFrame=function(a){a&&e.call(window,a)}}(),Wu.extend=Wu.Util.extend,Wu.bind=Wu.Util.bind,Wu.stamp=Wu.Util.stamp,Wu.setOptions=Wu.Util.setOptions,Wu.save=Wu.Util.post,Wu.post=Wu.Util.postcb,Wu.send=Wu.Util.send,Wu.parse=Wu.Util._parse,Wu.stringify=Wu.Util._stringify,Wu.zip=Wu.Util.generateZip,Wu.zave=Wu.Util.zipSave,Wu.can=Wu.Util.can,Wu.setStyle=Wu.Util.setStyle,Wu.getStyle=Wu.Util.getStyle,Wu.verify=Wu.Util.verifyResponse,Wu.getJSON=Wu.Util._getJSON,Wu.confirm=Wu.Util.confirm,Wu.Evented=Wu.Class.extend({on:function(a,b,c){if("object"==typeof a)for(var d in a)this._on(d,a[d],b);else{a=Wu.Util.splitWords(a);for(var e=0,f=a.length;f>e;e++)this._on(a[e],b,c)}return this},off:function(a,b,c){if(a)if("object"==typeof a)for(var d in a)this._off(d,a[d],b);else{a=Wu.Util.splitWords(a);for(var e=0,f=a.length;f>e;e++)this._off(a[e],b,c)}else delete this._events;return this},_on:function(a,b,c){var d=this._events=this._events||{},e=c&&c!==this&&Wu.stamp(c);if(e){var f=a+"_idx",g=a+"_len",h=d[f]=d[f]||{},i=Wu.stamp(b)+"_"+e;h[i]||(h[i]={fn:b,ctx:c},d[g]=(d[g]||0)+1)}else d[a]=d[a]||[],d[a].push({fn:b})},_off:function(a,b,c){var d=this._events,e=a+"_idx",f=a+"_len";if(d){if(!b)return delete d[a],delete d[e],void delete d[f];var g,h,i,j,k,l=c&&c!==this&&Wu.stamp(c);if(l)k=Wu.stamp(b)+"_"+l,g=d[e],g&&g[k]&&(j=g[k],delete g[k],d[f]--);else if(g=d[a])for(h=0,i=g.length;i>h;h++)if(g[h].fn===b){j=g[h],g.splice(h,1);break}j&&(j.fn=Wu.Util.falseFn)}},fire:function(a,b,c){if(!this.listens(a,c))return this;var d=Wu.Util.extend({},b,{type:a,target:this}),e=this._events;if(e){var f,g,h,i,j=e[a+"_idx"];if(e[a])for(h=e[a].slice(),f=0,g=h.length;g>f;f++)h[f].fn.call(this,d);for(i in j)j[i].fn.call(j[i].ctx,d)}return c&&this._propagateEvent(d),this},listens:function(a,b){var c=this._events;if(c&&(c[a]||c[a+"_len"]))return!0;if(b)for(var d in this._eventParents)if(this._eventParents[d].listens(a,b))return!0;return!1},once:function(a,b,c){if("object"==typeof a){for(var d in a)this.once(d,a[d],b);return this}var e=Wu.bind(function(){this.off(a,b,c).off(a,e,c)},this);return this.on(a,b,c).on(a,e,c)},addEventParent:function(a){return this._eventParents=this._eventParents||{},this._eventParents[Wu.stamp(a)]=a,this},removeEventParent:function(a){return this._eventParents&&delete this._eventParents[Wu.stamp(a)],this},_propagateEvent:function(a){for(var b in this._eventParents)this._eventParents[b].fire(a.type,Wu.extend({layer:a.target},a),!0)},bytesToSize:function(a){var b=["Bytes","KB","MB","GB","TB"];if(0==a)return"0 Byte";var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,c),2)+" "+b[c]}});var proto=Wu.Evented.prototype;proto.addEventListener=proto.on,proto.removeEventListener=proto.clearAllEventListeners=proto.off,proto.addOneTimeEventListener=proto.once,proto.fireEvent=proto.fire,proto.hasEventListeners=proto.listens,Wu.Mixin={Events:proto},Wu._on=proto.on,Wu._off=proto.off,Wu._fire=proto.fire,Wu.DomUtil={get:function(a){return"string"==typeof a?document.getElementById(a):a},getStyle:function(a,b){var c=a.style[b]||a.currentStyle&&a.currentStyle[b];if((!c||"auto"===c)&&document.defaultView){var d=document.defaultView.getComputedStyle(a,null);c=d?d[b]:null}return"auto"===c?null:c},create:function(a,b,c,d){var e=document.createElement(a);return e.className=b,c&&c.appendChild(e),d&&("input"==a?e.setAttribute("placeholder",d):"image"==a?e.src=d:"img"==a?e.src=d:e.innerHTML=d),e},makeit:function(a){var b=document.createElement(a.type);return a.id&&(b.id=a.id),a.cname&&(b.className=a.cname),a.style&&b.setAttribute("style",a.style),a.hlink&&b.setAttribute("href",a.hlink),a.source&&(b.src=a.source),a.inner&&(b.innerHTML=a.inner),a.appendto&&a.appendto.appendChild(b),a.attr&&a.attr.forEach(function(a){b.setAttribute(a[0],a[1])}),b},createId:function(a,b,c){var d=document.createElement(a);return d.id=b,c&&c.appendChild(d),d},remove:function(a){var b=a.parentNode;b&&b.removeChild(a)},toFront:function(a){a.parentNode.appendChild(a)},toBack:function(a){var b=a.parentNode;b.insertBefore(a,b.firstChild)},hasClass:function(a,b){if(void 0!==a.classList)return a.classList.contains(b);var c=Wu.DomUtil.getClass(a);return c.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){if(a)if(void 0!==a.classList)for(var c=Wu.Util.splitWords(b),d=0,e=c.length;e>d;d++)a.classList.add(c[d]);else if(!Wu.DomUtil.hasClass(a,b)){var f=Wu.DomUtil.getClass(a);Wu.DomUtil.setClass(a,(f?f+" ":"")+b)}},removeClass:function(a,b){a&&(void 0!==a.classList?a.classList.remove(b):Wu.DomUtil.setClass(a,Wu.Util.trim((" "+Wu.DomUtil.getClass(a)+" ").replace(" "+b+" "," "))))},classed:function(a,b,c){c?this.addClass(a,b):this.removeClass(a,b)},clearChildClasses:function(a,b){for(var c=0;c<a.children.length;c++){var d=a.children[c];Wu.DomUtil.removeClass(d,b)}},setClass:function(a,b){void 0===a.className.baseVal?a.className=b:a.className.baseVal=b},getClass:function(a){return void 0===a.className.baseVal?a.className:a.className.baseVal},appendTemplate:function(a,b){if("string"==typeof b){var c=Wu.DomUtil.create("div");for(c.innerHTML=b,i=0;i<c.childNodes.length;i++)a.appendChild(c.childNodes[i])}return a},prependTemplate:function(a,b,c){if("string"==typeof b){var d=Wu.DomUtil.create("div");if(d.innerHTML=b,c)var e=a.firstChild;else var e=a.firstChild.nextSibling;for(i=0;i<d.childNodes.length;i++)a.insertBefore(d.childNodes[i],e)}return a},thumbAdjust:function(a,b){var c=new Image;c.src=a.src,c.onload=function(){var c=this.width,d=this.height,e=c/b,f=d/b,g=!0;c>=d&&(g=!1),g?(a.style.width="100%",a.style.top=-Math.floor(f)/2+"px"):(a.style.height="100%",a.style.left=-Math.floor(e)/2+"px")}}};var eventsKey="_leaflet_events";Wu.DomEvent={on:function(a,b,c,d){if("object"==typeof b)for(var e in b)this._on(a,e,b[e],c);else{b=Wu.Util.splitWords(b);for(var f=0,g=b.length;g>f;f++)this._on(a,b[f],c,d)}return this},off:function(a,b,c,d){if("object"==typeof b)for(var e in b)this._off(a,e,b[e],c);else{b=Wu.Util.splitWords(b);for(var f=0,g=b.length;g>f;f++)this._off(a,b[f],c,d)}return this},_on:function(a,b,c,d){var e=b+Wu.stamp(c)+(d?"_"+Wu.stamp(d):"");if(a[eventsKey]&&a[eventsKey][e])return this;var f=function(b){return c.call(d||a,b||window.event)},g=f;return Wu.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,f,e):(Wu.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener&&this.addDoubleTapListener(a,f,e),"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",f,!1),a.addEventListener(b,f,!1)):"mouseenter"===b||"mouseleave"===b?(f=function(b){return b=b||window.event,Wu.DomEvent._checkMouse(a,b)?g(b):void 0},a.addEventListener("mouseenter"===b?"mouseover":"mouseout",f,!1)):("click"===b&&Wu.Browser.android&&(f=function(a){return Wu.DomEvent._filterClick(a,g)}),a.addEventListener(b,f,!1)):"attachEvent"in a&&a.attachEvent("on"+b,f),a[eventsKey]=a[eventsKey]||{},a[eventsKey][e]=f,this)},_off:function(a,b,c,d){var e=b+Wu.stamp(c)+(d?"_"+Wu.stamp(d):""),f=a[eventsKey]&&a[eventsKey][e];return f?(Wu.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,e):Wu.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,e):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",f,!1),a.removeEventListener(b,f,!1)):a.removeEventListener("mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,f,!1):"detachEvent"in a&&a.detachEvent("on"+b,f),a[eventsKey][e]=null,this):this},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,Wu.DomEvent._skipped(a),this},disableScrollPropagation:function(a){return Wu.DomEvent.on(a,"mousewheel MozMousePixelScroll",Wu.DomEvent.stopPropagation)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return Wu.DomEvent.preventDefault(a).stopPropagation(a)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b},_skipEvents:{},_fakeStop:function(a){Wu.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_filterClick:function(a,b){var c=a.timeStamp||a.originalEvent.timeStamp,d=Wu.DomEvent._lastClick&&c-Wu.DomEvent._lastClick;return d&&d>100&&500>d||a.target._simulatedClick&&!a._simulated?void Wu.DomEvent.stop(a):(Wu.DomEvent._lastClick=c,b(a))}},function(){var a=navigator.userAgent.toLowerCase(),b=document.documentElement,c="ActiveXObject"in window,d=-1!==a.indexOf("webkit"),e=-1!==a.indexOf("phantom"),f=-1!==a.search("android [23]"),g=-1!==a.indexOf("chrome"),h="undefined"!=typeof orientation,i=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,j=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||i,k=c&&"transition"in b.style,l="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!f,m="MozPerspective"in b.style,n="OTransition"in b.style,o="devicePixelRatio"in window&&window.devicePixelRatio>1;if(!o&&"matchMedia"in window){var p=window.matchMedia("(min-resolution:1.5dppx)");o=p&&p.matches}var q=!window.L_NO_TOUCH&&!e&&(j||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);Wu.Browser={ie:c,ielt9:c&&!document.addEventListener,webkit:d,gecko:-1!==a.indexOf("gecko")&&!d&&!window.opera&&!c,android:-1!==a.indexOf("android"),android23:f,chrome:g,safari:!g&&-1!==a.indexOf("safari"),ie3d:k,webkit3d:l,gecko3d:m,opera3d:n,any3d:!window.L_DISABLE_3D&&(k||l||m||n)&&!e,mobile:h,mobileWebkit:h&&d,mobileWebkit3d:h&&l,mobileOpera:h&&window.opera,touch:!!q,msPointer:!!i,pointer:!!j,retina:!!o}}(),Wu.extend(Wu.DomEvent,{POINTER_DOWN:Wu.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:Wu.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:Wu.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:Wu.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(a,b,c,d){switch(b){case"touchstart":return this.addPointerListenerStart(a,b,c,d);case"touchend":return this.addPointerListenerEnd(a,b,c,d);case"touchmove":return this.addPointerListenerMove(a,b,c,d);default:throw"Unknown touch event type"}},addPointerListenerStart:function(a,b,c,d){var e="_leaflet_",f=this._pointers,g=function(a){Wu.DomEvent.preventDefault(a);for(var b=!1,d=0;d<f.length;d++)if(f[d].pointerId===a.pointerId){b=!0;break}b||f.push(a),a.touches=f.slice(),a.changedTouches=[a],c(a)};if(a[e+"touchstart"+d]=g,a.addEventListener(this.POINTER_DOWN,g,!1),!this._pointerDocumentListener){var h=function(a){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f.splice(b,1);break}};document.documentElement.addEventListener(this.POINTER_UP,h,!1),document.documentElement.addEventListener(this.POINTER_CANCEL,h,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(a,b,c,d){function e(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons){for(var b=0;b<g.length;b++)if(g[b].pointerId===a.pointerId){g[b]=a;break}a.touches=g.slice(),a.changedTouches=[a],c(a)}}var f="_leaflet_",g=this._pointers;return a[f+"touchmove"+d]=e,a.addEventListener(this.POINTER_MOVE,e,!1),this},addPointerListenerEnd:function(a,b,c,d){var e="_leaflet_",f=this._pointers,g=function(a){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f.splice(b,1);break}a.touches=f.slice(),a.changedTouches=[a],c(a)};return a[e+"touchend"+d]=g,a.addEventListener(this.POINTER_UP,g,!1),a.addEventListener(this.POINTER_CANCEL,g,!1),this},removePointerListener:function(a,b,c){var d="_leaflet_",e=a[d+b+c];switch(b){case"touchstart":a.removeEventListener(this.POINTER_DOWN,e,!1);break;case"touchmove":a.removeEventListener(this.POINTER_MOVE,e,!1);break;case"touchend":a.removeEventListener(this.POINTER_UP,e,!1),a.removeEventListener(this.POINTER_CANCEL,e,!1)}return this}}),Wu.DomEvent.addListener=Wu.DomEvent.on,Wu.DomEvent.removeListener=Wu.DomEvent.off,Array.prototype.diff=function(a){return this.filter(function(b){return a.indexOf(b)<0})},Array.prototype.move=function(a,b){this.splice(b,0,this.splice(a,1)[0])},Array.prototype.moveUp=function(a,b){var c=this.indexOf(a),d=c-(b||1);if(-1===c)throw new Error("Element not found in array");0>d&&(d=0),this.splice(c,1),this.splice(d,0,a)},Array.prototype.moveDown=function(a,b){var c=this.indexOf(a),d=c+(b||1);if(-1===c)throw new Error("Element not found in array");d>=this.length&&(d=this.length),this.splice(c,1),this.splice(d,0,a)},String.prototype.camelize=function(){return this.replace(/(?:^|[_])(\w)/g,function(a,b){return b?b.toUpperCase():""})},Function.prototype.bind=Function.prototype.bind||function(a){var b=this;return function(){return b.apply(a,arguments)}},Wu.Invite=Wu.Class.extend({options:{},initialize:function(a){Wu.setOptions(this,a),this._invite=a.store||{},document.title=loginConfig.pageTitle,this._initContainer(),this._initContent()},_initContainer:function(){this._container=Wu.DomUtil.get(this.options.container)},_initContent:function(){this._createLogo(),this._centralWrapper=Wu.DomUtil.create("div","central",this._container),this._createLogin(),this._createRegister(),this._rightshader.style.opacity=1},_createLogo:function(){var a=Wu.DomUtil.create("div","logo-wrap",this._container),b=Wu.DomUtil.create("div","logo",a),c=loginConfig.invitationLogo;b.style.backgroundImage=c;var d=loginConfig.loginLogoWidth||210;b.style.width=d+"px"},_createLogin:function(){var a=Wu.DomUtil.create("div","left",this._centralWrapper);this._rightshader=Wu.DomUtil.create("div","shader",a);var b=(Wu.DomUtil.create("div","top-label",a,"Log in"),Wu.DomUtil.create("form","input-wrapper",a));b.setAttribute("action","/login"),b.setAttribute("method","post");var c=Wu.DomUtil.create("input","input",b,"Email Address");c.setAttribute("name","email");var d=Wu.DomUtil.create("input","input",b,"Password");d.setAttribute("type","password"),d.setAttribute("name","password");var e=Wu.DomUtil.create("button","button",b,"Login");e.setAttribute("type","submit"),e.setAttribute("name","login");var f=Wu.DomUtil.create("div","forgot-wrapper",b),g=Wu.DomUtil.create("a","forgot-link",f,"Forgot your password?");g.setAttribute("href","https://"+window.location.host+"/forgot"),Wu.DomEvent.on(a,"mouseenter",function(){this._rightshader.style.opacity=0,this._leftshader.style.opacity=1},this)},_createRegister:function(){var a=this._rightWrapper=Wu.DomUtil.create("div","right",this._centralWrapper);this._leftshader=Wu.DomUtil.create("div","shader",a);var b=(Wu.DomUtil.create("div","top-label",a,"Create account"),Wu.DomUtil.create("form","input-wrapper-right",a));b.setAttribute("action","/register"),b.setAttribute("method","post");var c=Wu.DomUtil.create("input","input firstname",b,"Choose a username");c.setAttribute("name","username");var d=Wu.DomUtil.create("input","input firstname",b,"First Name");d.setAttribute("name","firstname");var e=Wu.DomUtil.create("input","input lastname",b,"Last Name");e.setAttribute("name","lastname");var f=Wu.DomUtil.create("input","input company",b,"Company");f.setAttribute("name","company");var g=Wu.DomUtil.create("input","input position",b,"Position");g.setAttribute("name","position");var h=Wu.DomUtil.create("input","input email",b,"Email Address");h.setAttribute("name","email"),h.value=this._invite.email||"";var i=Wu.DomUtil.create("input","input password",b,"Password (minimum 8 characters)");i.setAttribute("type","password"),i.setAttribute("name","password");var j=Wu.DomUtil.create("input","",b);j.value=this._invite.token||!1,j.style.display="none",j.setAttribute("name","invite_token");var k=Wu.DomUtil.create("input","",b,"Password (minimum 8 characters)");k.setAttribute("type","checkbox"),k.id="privacy-checkbox";var l=document.createElement("label");l.htmlFor="privacy-checkbox",l.innerHTML='I have read and agree to Systemapic\'s <a href="privacy-policy" target="_blank">Terms and Conditions</a>',b.appendChild(l);var m=this._submitBtn=Wu.DomUtil.create("button","button",b,"Sign up");m.setAttribute("type","submit"),m.setAttribute("type","submit"),m.disabled=!0,Wu.DomEvent.on(k,"click",function(){m.disabled=!k.checked,this._privacyChecked=k.checked,this.checkSubmitBtn()},this),Wu.DomEvent.on(a,"mouseenter",function(){this._rightshader.style.opacity=1,this._leftshader.style.opacity=0},this),Wu.DomEvent.on(c,"keyup",this._checkUniqueUsername,this),Wu.DomEvent.on(c,"blur",this._checkUniqueUsername,this),Wu.DomEvent.on(h,"keyup",this._checkUniqueEmail,this),Wu.DomEvent.on(h,"blur",this._checkUniqueEmail,this),setTimeout(function(){this._checkUniqueEmail({target:h})}.bind(this),500)},checkSubmitBtn:function(){var a=this._uniqueUsername&&this._uniqueEmail&&this._privacyChecked;this._submitBtn.disabled=!a},_checkUniqueEmail:function(a){var b=a.target,c=b.value;this._post("/api/user/uniqueEmail",{email:c},function(a,c){this._uniqueEmail=c.unique,this.checkSubmitBtn(),b.style.backgroundColor=this._uniqueEmail?"transparent":"#FF4545"}.bind(this))},_checkUniqueUsername:function(a){var b=a.target,c=b.value;this._post("/api/user/uniqueUsername",{username:c},function(a,c){this._uniqueUsername=c.unique,this.checkSubmitBtn(),b.style.backgroundColor=this._uniqueUsername?"transparent":"#FF4545"}.bind(this))},_post:function(a,b,c){var d=window.location.origin+a,e=new XMLHttpRequest;e.open("POST",d,!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=Wu.parse(e.responseText);c&&c(null,a)}},Wu.Util.isObject(b)&&(b=JSON.stringify(b)),e.send(b)}});